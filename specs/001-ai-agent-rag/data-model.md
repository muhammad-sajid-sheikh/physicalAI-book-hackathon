# Data Model: AI Agent with Retrieval-Augmented Generation

## Overview
This document defines the key entities and data structures for the AI agent with retrieval capabilities.

## Entities

### AI Agent
**Description**: An intelligent system that processes user queries and orchestrates tool usage to generate responses
**Fields**:
- agent_id: String (unique identifier for the agent instance)
- created_at: DateTime (timestamp when agent was initialized)
- configuration: Object (settings for the agent including model, temperature, etc.)
- tools: Array (list of available tools including the Qdrant retrieval tool)

### Retrieval Tool
**Description**: A component that interfaces with Qdrant to search and retrieve relevant document chunks
**Fields**:
- tool_id: String (unique identifier for the tool)
- name: String (name of the tool, e.g., "qdrant_search")
- description: String (description of what the tool does)
- parameters: Object (input parameters for the tool including query string)
- response_format: Object (structure of the expected response)

### Query
**Description**: A natural language question from a user that the agent needs to answer using the knowledge base
**Fields**:
- query_id: String (unique identifier for the query)
- content: String (the actual user query)
- timestamp: DateTime (when the query was received)
- agent_id: String (reference to the agent handling the query)

### Retrieved Chunk
**Description**: A segment of book content retrieved from Qdrant that is relevant to the user's query
**Fields**:
- chunk_id: String (unique identifier for the chunk)
- content: String (the actual text content of the chunk)
- doc_id: String (identifier of the original document)
- chapter_id: String (identifier of the chapter in the book)
- start_offset: Integer (starting position of the chunk in the original text)
- end_offset: Integer (ending position of the chunk in the original text)
- similarity_score: Float (relevance score from vector search)
- language: String (language of the content)

### Agent Response
**Description**: The response generated by the agent based on retrieved content
**Fields**:
- response_id: String (unique identifier for the response)
- query_id: String (reference to the original query)
- content: String (the actual response content)
- retrieved_chunks: Array (list of chunk IDs used to generate the response)
- timestamp: DateTime (when the response was generated)
- confidence_score: Float (confidence level in the response accuracy)

## Relationships

1. **AI Agent** has many **Queries** (one agent can handle multiple queries)
2. **Query** has one **Agent Response** (each query gets one response)
3. **Agent Response** references many **Retrieved Chunks** (responses are based on multiple chunks)
4. **Retrieval Tool** is used by **AI Agent** (the tool is registered with the agent)

## Validation Rules

1. **Query** content must not be empty
2. **Retrieved Chunk** similarity_score must be between 0 and 1
3. **Agent Response** must contain content from **Retrieved Chunks** only
4. **Retrieved Chunk** start_offset must be less than end_offset
5. **Agent Response** confidence_score must be between 0 and 1

## State Transitions

1. **Query** transitions from "received" → "processing" → "responded"
2. **Agent Response** transitions from "generating" → "completed"